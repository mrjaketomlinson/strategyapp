{% extends "base.html" %}

{% block title %}Planning Events{% endblock %}

{% block body %}

<div class="container">
  <h1>Planning Events</h1>
  <div class="d-flex">
    <div class="flex-fill p-1">
      <input class="form-control" type="text" id="searchInput" onkeyup="searchTable()"
        placeholder="Search...">
    </div>
    <div class="p-1">
      <button type="button" id="createPlanningEventBtn" class="btn" data-bs-toggle="modal" data-bs-target="#modal" onclick="createPlanningEvent(this)" data-url="{% url 'strategy:planning_event_create' %}">
        <span class="material-symbols-outlined">
          add
        </span>
      </button>
    </div>
  </div>
  <table id="planningEventTable" class="table table-hover table-responsive">
    <thead>
      <tr>
        <th>Name</th>
        <th>Time Period</th>
      </tr>
    </thead>
    {% for event in planning_events %}
      <tr>
        <td>
          <button type="button" id="editPlanningEventBtn" class="btn btn-link p-0" data-bs-toggle="modal" data-bs-target="#modal" onclick="editPlanningEvent(this)" data-url="{% url 'strategy:planning_event_edit' planning_event_id=event.pk %}">
            {{ event.name }}
          </button>
        </td>
        <td>{{ event.time_period.name }}</td>
      </tr>
    {% endfor %}
  </table>
</div>

{% endblock %}

{% block scripts %}

<script type="text/javascript">
  function createPlanningEvent(identifier) {
    $.ajax({
      url: $(identifier).data("url"),
      data: {},
      dataType: "json",
      success: function (data) {
        $("#modal-title").html(data.title);
        $("#modal-body").html(data.body);
        if (data.footer) {
          $("#modal-footer").html(data.footer);
          $("#modal-footer").removeClass("d-none")
        }
      },
      error: function (jqXHR, textStatus, errorThrown) {
        alert("Something went wrong. If the issue persists, please reach out to the Bould team.");
      }
    });
  }
  function editPlanningEvent(identifier) {
    $.ajax({
      url: $(identifier).data("url"),
      data: {},
      dataType: "json",
      success: function (data) {
        $("#modal-title").html(data.title);
        $("#modal-body").html(data.body);
        if (data.footer) {
          $("#modal-footer").html(data.footer);
          $("#modal-footer").removeClass("d-none")
        }
      },
      error: function (jqXHR, textStatus, errorThrown) {
        alert("Something went wrong. If the issue persists, please reach out to the Bould team.");
      }
    });
  }
</script>

{% endblock %}